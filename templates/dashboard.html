{% extends "base.html" %} {% block content %}

<h1 class="title-2 mb-3 text-center" data-aos="zoom-in">PAINEL</h1>

<div class="container-fluid p-4 pt-0" data-aos="fade-up">
 <!-- KPIs -->
 <div class="row g-3 mb-5">
  <div class="col-md-3">
   <div class="card shadow-sm text-center p-3">
    <h5>Negócios</h5>
    <h2>{{ total_businesses }}</h2>
   </div>
  </div>
  <div class="col-md-3">
   <div class="card shadow-sm text-center p-3">
    <h5>Negócios Premium</h5>
    <h2>{{ premium_count }}</h2>
   </div>
  </div>
  <div class="col-md-3">
   <div class="card shadow-sm text-center p-3">
    <h5>Usuários</h5>
    <h2>{{ total_users }}</h2>
   </div>
  </div>
  <div class="col-md-3">
   <div class="card shadow-sm text-center p-3">
    <h5>Comentários</h5>
    <h2>{{ total_comentarios }}</h2>
   </div>
  </div>
  <div class="col-md-3">
   <div class="card shadow-sm text-center p-3">
    <h5>Feeds</h5>
    <h2>{{ total_feeds }}</h2>
   </div>
  </div>
 </div>

 <!-- Tabelas -->
 <div class="row">
  <div class="col-md-12 mb-4">
   <div class="card shadow-sm p-3">
    <h4>Negócios</h4>
    <table id="businesses-table" class="table table-striped table-bordered">
     <thead>
      <tr>
       <th>ID</th>
       <th>Nome</th>
       <th>Categoria</th>
       <th>Dono</th>
       <th>Premium</th>
       <th>Premium até</th>
       <th>Evento</th>
       <th>Data</th>
       <th>Ações</th>
      </tr>
     </thead>
    </table>
   </div>
  </div>

  <div class="col-md-12 mb-4">
   <div class="card shadow-sm p-3" style="overflow-x: auto;">
    <h4>Usuários</h4>
    <table id="users-table" class="table table-striped table-bordered" style="width: 100%;">
     <thead>
      <tr>
       <th>ID</th>
       <th>Nome</th>
       <th>Email</th>
       <th>Contato</th>
       <th>Cargo</th>
       <th>Ações</th>
      </tr>
     </thead>
    </table>
   </div>
  </div>

  <div class="col-md-12 mb-4">
   <div class="card shadow-sm p-3" style="overflow-x: auto;">
    <h4>Comentários</h4>
    <table id="comments-table" class="table table-striped table-bordered" style="width: 100%;">
     <thead>
      <tr>
       <th>ID</th>
       <th>Autor</th>
       <th>Negócio</th>
       <th>Data</th>
       <th>Editado</th>
       <th>Ações</th>
      </tr>
     </thead>
    </table>
   </div>
  </div>

  <div class="col-md-12">
   <div class="card shadow-sm p-3" style="overflow-x: auto;">
    <h4>Feeds</h4>
    <table id="feeds-table" class="table table-striped table-bordered" style="width: 100%;">
     <thead>
      <tr>
       <th>ID</th>
       <th>Negócio</th>
       <th>Data</th>
       <th>Ações</th>
      </tr>
     </thead>
    </table>
   </div>
  </div>
 </div>
</div>

<!-- jQuery + DataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>

<script>
 $(document).ready(function () {
  $("#businesses-table").DataTable({
   ajax: "/api/businesses",
   scrollX: true,
   columns: [
    { data: "id" },
    { data: "nome" },
    { data: "categoria" },
    { data: "owner" },
    { data: "premium" },
    { data: "premium_valid_until" },
    { data: "evento" },
    { data: "created_at" },
    { data: "actions", orderable: false, searchable: false },
   ],
  });

  $("#users-table").DataTable({
   ajax: "/api/users",
   scrollX: true,
   columns: [{ data: "id" }, { data: "nome" }, { data: "email" }, { data: "contact" }, { data: "role" }, { data: "actions" }],
  });

  $("#comments-table").DataTable({
   ajax: "/api/comments",
   scrollX: true,
   columns: [{ data: "id" }, { data: "autor" }, { data: "business_id" }, { data: "created_at" }, { data: "edited" }, { data: "actions", orderable: false, searchable: false }],
  });

  $("#feeds-table").DataTable({
   ajax: "/api/feeds",
   scrollX: true,
   columns: [
    { data: "id" },
    { data: "business_id" },
    { data: "created_at" },
    {
     data: "feed_id",
     render: function (feed_id) {
      return `<form method="POST" action="/feed/${feed_id}/del" style="display:inline">
                            <button class="btn btn-sm btn-outline-danger">Excluir</button>
                          </form>`;
     },
     orderable: false,
     searchable: false,
    },
   ],
  });
 });
</script>
{% endblock %}
