{% extends "base.html" %} {% block content %}
<div class="container p-4 pt-0" data-aos="fade-up">
  <div class="card shadow-sm" style="max-width: 800px; margin: auto;">
    <div class="card-header bg-primary text-white text-center py-3 px-3">
      <h4 class="mb-0">Adicionar Negócio</h4>
    </div>
    <div class="card-body p-4 d-flex justify-content-center">
      <form class="row g-4 w-100" style="max-width: 700px;" action="/addbusiness" method="POST" enctype="multipart/form-data">
        
        <div class="row align-items-center mt-4">
          <!-- Logo -->
          <div class="col-auto text-center">
            <input class="form-control d-none" type="file" id="logoUpload" name="logo" accept="image/*" onchange="previewLogo(event)" />
            <img src="https://placehold.co/150" alt="Logo" class="rounded-circle border"
                 style="width: 75px; height: 75px; object-fit: cover; cursor: pointer;"
                 onclick="document.getElementById('logoUpload').click();" />
          </div>

          <!-- Nome -->
          <div class="col">
            <label for="nome" class="form-label fw-semibold">Nome</label>
            <input type="text" class="form-control" id="nome" name="nome" required />        
            <div class="lead form-text" style="font-size: 0.7rem;">Escolha um nome que represente bem o seu negócio.</div>
          </div>


      </div>

          <!-- Categoria -->
          <div class="col-12 col-md-12">
            <label for="categoria" class="form-label fw-semibold">Categoria</label>
            <select class="form-select" name="categoria" required>
              <option value="" selected disabled>Escolha...</option>
              <option value="Alimentação">Alimentação</option>
              <option value="Livros e Educação">Livros e Educação</option>
              <option value="Tecnologia e Informática">Tecnologia e Informática</option>
              <option value="Serviços">Serviços</option>
              <option value="Arte e Cultura">Arte e Cultura</option>
              <option value="Moda e Beleza">Moda e Beleza</option>
              <option value="Esportes e Lazer">Esportes e Lazer</option>
              <option value="Eventos e Entretenimento">Eventos e Entretenimento</option>
              <option value="Comércio de segunda mão">Comércio de segunda mão</option>
              <option value="Pets e Animais">Pets e Animais</option>
              <option value="Saúde e Bem-estar">Saúde e Bem-estar</option>
              <option value="Turismo e Viagens">Turismo e Viagens</option>
              <option value="Diversos">Diversos</option>
            </select>
          </div>

        <div class="col-12"> <label for="descricao" class="form-label" style="font-weight: 600;">Descrição</label> <textarea class="form-control limiteDeChar" id="descricao" name="descricao" rows="5" placeholder="Fale sobre seu negócio, produtos, serviços e diferenciais." maxlength="350"></textarea> <div id="charCount">0 / 350</div> </div>

        <div class="col-12">
          <label for="contato" class="form-label" style="font-weight: 600;">Contato <small>(opcional)</small></label>

          <fieldset>
          <div class="row g-3">
            <div class="col-6">
              <label for="inputInsta" class="form-label">Instagram</label>
              <div class="input-group has-validation">
                <span class="input-group-text"><i class="bi bi-instagram"></i></span>
                <input name="insta" type="text" class="form-control" id="inputInsta" placeholder="@examplo"/>
              </div>
            </div>
            <div class="col-6">
              <label for="inputNumber" class="form-label">Telefone</label>
              <div class="input-group has-validation">
                <span class="input-group-text"><i class="bi bi-telephone"></i></span>
                <input name="number" type="text" class="form-control" id="inputNumber" placeholder="(XX) XXXXX-XXXX" />
              </div>
            </div>

        <div class="lead form-text mt-1 mb-3" style="font-size: 0.7rem;">O plano inicial permite somente escolher um dos dois meios de contato disponíveis.</div>
          </div>

        <div class="col-12">
          <label class="form-label fw-bold mb-2">Participa de algum evento? <small>(opcional)</small></label>
          <div class="d-flex gap-3">
            <div class="card p-3 selectable" data-event="">
              Não participa
            </div>
            <div class="card p-3 selectable" data-event="Feira do Empreendedor">
              Feira do Empreendedor
            </div>
        </div>
      </div>

    <input type="hidden" name="evento" id="evento">

        <div class="d-grid mt-4">
          <button type="submit" class="btn btn-primary">Adicionar Negócio</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  const hiddenInput = document.getElementById('evento');

  document.querySelectorAll('.selectable').forEach(card => {
    card.addEventListener('click', () => {
      // remove destaque dos outros
      document.querySelectorAll('.selectable').forEach(c => c.classList.remove('active'));

      // ativa o clicado
      card.classList.add('active');

      // seta valor no input hidden
      hiddenInput.value = card.dataset.event;
    });
  });
</script>

<script>
  const check = document.getElementById('participaEvento');
  const select = document.getElementById('eventos');

  check.addEventListener('change', () => {
    select.disabled = !check.checked;
  });
</script>

<script>
  function previewLogo(event) {
    const [file] = event.target.files;
    if (file) {
      const imgElement = event.target.closest('div').querySelector('img');
      imgElement.src = URL.createObjectURL(file);
    }
  }
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const estadoSelect = document.getElementById("estado");
    const municipioSelect = document.getElementById("municipio");

    estadoSelect.addEventListener("change", function () {
      const uf = this.value;
      municipioSelect.innerHTML = "<option value='' selected disabled>Carregando...</option>";

      fetch(`/get_municipios/${uf}`)
        .then((res) => res.json())
        .then((data) => {
          municipioSelect.innerHTML = "<option value='' selected disabled>Escolha...</option>";
          data.forEach((m) => {
            const opt = document.createElement("option");
            opt.value = m.nome;
            opt.textContent = m.nome;
            municipioSelect.appendChild(opt);
          });
        })
        .catch((err) => {
          console.error("Erro ao carregar municípios:", err);
          municipioSelect.innerHTML = "<option value='' selected disabled>Erro ao carregar</option>";
        });
    });
  });
</script>

<script>
// Input fields
const instagramInput = document.getElementById("inputInsta");
const phoneInput = document.getElementById("inputNumber");

// Array
const contactInputs = [instagramInput, phoneInput, emailInput];

// Gerenciar 
function handleInputBehavior(){

  const filledInput = contactInputs.find(input => input.value.trim() !== '');

  //Se um dos contatos tem algum valor, desativa os outros
  if (filledInput) {
    contactInputs.forEach(input => {
      if (input !== filledInput) {
        input.disabled = true;
        input.classList.add('disabled');
      }
    });
  } else{
    //Se não tem nenhum valor, re-ativa todos.
    contactInputs.forEach(input => {
      input.disabled = false;
      input.classList.remove('disabled');
    })
  }
}

//Adiciona event listeners para cada input
contactInputs.forEach(input => {
  input.addEventListener('input', handleInputBehavior);
});

//Run a função ao carregar a página
document.addEventListener('DOMContentLoaded', handleInputBehavior)

</script>

{% endblock %}